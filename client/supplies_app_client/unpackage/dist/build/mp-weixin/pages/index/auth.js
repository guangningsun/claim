(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/auth"],{2281:function(e,t,o){"use strict";var n=o("807b"),a=o.n(n);a.a},"448e":function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},"807b":function(e,t,o){},a1bc:function(e,t,o){"use strict";o.r(t);var n=o("dbd4"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},b969:function(e,t,o){"use strict";o.r(t);var n=o("448e"),a=o("a1bc");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("2281");var s,u=o("f0c5"),r=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=r.exports},d516:function(e,t,o){"use strict";(function(e){o("0152"),o("921b");n(o("66fd"));var t=n(o("b969"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},dbd4:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{modalName:null,openid:"",headImg:"../../static/submit1.png",user_nickname:"",user_phone:"",user_auth:"",shouldShowContent:!1,showCenterIcon:!0,hint:"登录后可以完整使用部门物品申领、审批服务。首次使用，需要授权获取您的手机号进行登录绑定。"}},onLoad:function(){},onShow:function(){var t=this;this.user_phone=e.getStorageSync("key_phone_num"),this.openid=e.getStorageSync("key_wx_openid"),this.user_auth=e.getStorageSync("key_user_auth"),e.login({provider:"weixin",success:function(e){console.log("+++code："+e.code),t.requestWithMethod(getApp().globalData.api_login+e.code,"POST","",t.successCb,t.failCb,t.completeCb)}})},methods:{showPhoneModal:function(e){this.modalName=e},hideModal:function(e){this.modalName=null},successCb:function(t){if(console.log(t),0===t.data.error){this.openid=t.data.openid;var o=t.data.is_login,n=t.data.auth;e.setStorage({key:"key_user_auth",data:n}),e.setStorage({key:"key_wx_openid",data:t.data.openid}),"0"===o?this.showPhoneModal("PhoneModal"):(console.log("auth:"+n),e.showLoading({title:"登录中..."}),"0"===n?(e.hideLoading(),this.shouldShowContent=!0):"1"===n||"2"===n||"3"===n?(e.hideLoading(),e.navigateTo({url:"../approve/approve"})):this.showToast("未知错误!"))}},failCb:function(e){console.log("api_login failed",e)},completeCb:function(e){},onClickScan:function(){var t=this;e.showLoading({title:"跳转中"}),e.scanCode({onlyFromCamera:!0,success:function(o){if(t.showCenterIcon=!1,e.hideLoading(),console.log("条码类型："+o.scanType),console.log("条码内容："+o.result),t.containsStr(o.result,"http")){var n=o.result.split("/");e.setStorageSync("key_cat",n[n.length-1]),e.navigateTo({url:"../category/category"})}}})},onClickHistory:function(){e.navigateTo({url:"../history/history"})},onGotUserInfo:function(t){console.log(t),console.log(t.detail.userInfo.avatarUrl),this.headImg=t.detail.userInfo.avatarUrl,this.user_nickname=t.detail.userInfo.nickName,e.setStorage({key:"key_user_head",data:t.detail.userInfo.avatarUrl}),e.setStorage({key:"key_user_nickname",data:t.detail.userInfo.nickName})},successPhoneCb:function(t){if(console.log("api_phone success"),this.showCenterIcon=!1,this.containsStr(t.errMsg,"ok")){e.setStorage({key:"key_phone_num",data:t.data.purePhoneNumber}),e.setStorage({key:"key_user_auth",data:t.data.auth});var o=t.data.auth;console.log("phone cb auth: "+o),e.hideLoading(),"0"===o?this.shouldShowContent=!0:"1"!==o&&"2"!==o&&"3"!==o||e.navigateTo({url:"../approve/approve"})}},failPhoneCb:function(e){console.log("api_phone failed",e)},completePhoneCb:function(e){},getPhoneNumber:function(t){this.hideModal();if("getPhoneNumber:fail user deny"==t.detail.errMsg)e.showModal({title:"提示",showCancel:!1,content:"未授权将无法登录",success:function(e){}});else{e.showLoading({title:"跳转中"});var o={encryptedData:t.detail.encryptedData,iv:t.detail.iv,openid:this.openid};this.requestWithMethod(getApp().globalData.api_getWXInfo,"POST",o,this.successPhoneCb,this.failPhoneCb,this.completePhoneCb)}}}};t.default=o}).call(this,o("543d")["default"])}},[["d516","common/runtime","common/vendor"]]]);